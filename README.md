# üßÆ Math Trainer ‚Äî Gemini-Powered Question Generator (with MCQs)

A tiny, fun math trainer for the browser. It generates **brand-new, Gemini-written questions**‚Äîcomplete with **MCQs (4 options, one correct)**, playful **intros/closers + emojis**, and an **LLM sample solution** on demand. The app stores up to **8 recent questions** and guarantees a **fresh question on every Next click** for the same (area, level, grade, sport) combo.

üîó **Live Demo:** [Math Trainer App](https://saketh14.github.io/Question-Generator-UI/)

---

## ‚ú® Features

* **Gemini-only generation**: No local templates. Every question is produced by the model.  
* **MCQs**: 4 plausible options; exactly one correct.  
* **Sample answers**: Generated by Gemini when you click **Show Sample Answer** (or pre-bundled with the question).  
* **Freshness**: De-dup logic so repeated generations for the same combo produce different word problems.  
* **Capped history**: Keeps **latest 8** questions in the current session.  
* **Playful UX**: Random intros, closers, and sport emoji themes.  
* **Resilient JSON parsing**: Handles code-fences/wrap; retries the bridge; clearer error messages.  

---

## üß© How it works (high level)

1. User selects **Area, Difficulty, Grade, Sport** and clicks **Generate**.  
2. Frontend calls a **Cloudflare Worker** with a **prompt-tuned request** and asks **Gemini 1.5** for a **strict JSON** payload:

   ```json
   {
     "problem": "string (2‚Äì4 sentences; no solution text)",
     "choices": ["string", "string", "string", "string"],
     "answer_index": 0,
     "solution_html": "string (short HTML, 3‚Äì6 lines, ends with <strong>Answer: ‚Ä¶</strong>)"
   }
   ```
3. UI renders the question, MCQs, and meta. **Next** always calls Gemini for a new question for the current combo.  
4. Clicking **Show Sample Answer** renders `solution_html` (or asks Gemini to solve if not provided).  

---

## üóÇ Project structure

```
public/
  index.html        # UI (form + buttons + containers)
  styles.css        # Styles (buttons, choice states, etc.)
  script.js         # App logic (Gemini calls, rendering, state)
workers/
  bridge.js         # Cloudflare Worker proxy for Gemini
.env                # Gemini API keys (stored securely in Worker env)
```

---

## üöÄ Quick start

### 1) Cloudflare Worker (Gemini bridge)

Create `workers/bridge.js`:

```js
export default {
  async fetch(request, env) {
    if (request.method !== "POST") {
      return new Response("Method Not Allowed", { status: 405 });
    }
    try {
      const body = await request.json();

      const payload = {
        contents: [{ role: "user", parts: [{ text: body.prompt }] }],
      };

      const r = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/${env.GEMINI_MODEL}:generateContent?key=${env.GEMINI_API_KEY}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        }
      );

      if (!r.ok) {
        return new Response(`Gemini error: ${r.status}`, { status: 502 });
      }

      const data = await r.json();
      const text =
        data?.candidates?.[0]?.content?.parts?.[0]?.text || JSON.stringify(data);

      return new Response(text, { headers: { "Content-Type": "application/json" } });
    } catch (err) {
      return new Response(`Worker error: ${err.message}`, { status: 500 });
    }
  },
};
```

Set environment variables in Cloudflare Dashboard:

```
GEMINI_API_KEY=your_api_key_here
GEMINI_MODEL=gemini-1.5-flash
```

Deploy the Worker. It will be available at:  
`https://your-worker.subdomain.workers.dev/api/next`

---

### 2) Wire the frontend

In `script.js`, call your Worker:

```js
async function fetchLLMQuestion(prompt) {
  const res = await fetch('/api/next', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt })
  });
  if (!res.ok) throw new Error(await res.text());
  return await res.json();
}
```

---

### 3) Run locally

- Open `index.html` directly in a browser, or use a local server like **VS Code Live Server**.  

### 4) Deploy

- Push code to GitHub.  
- Enable **GitHub Pages**.  
- Your app will be live at:  
  `https://<username>.github.io/Question-Generator-UI/`

---

## üîß Configuration & customization

* **Max questions**: Default is 5; change via `MAX_QUESTIONS` in `script.js`.  
* **Freshness**: ‚ÄúNext‚Äù always calls Gemini for a new problem; de-dup logic retries up to 3 times if repeated.  
* **Sports, intros, closers**: Edit arrays in `script.js`.  
* **Prompt tuning**: Adjust system guide and few-shot examples for stricter outputs.  
* **Persistence**: History stored in `localStorage`:  
  * Attempts: `mathTrainerHistoryV4`  
  * Learned snippets: `trainerLearnedV3`  

---

## üß™ JSON contract (Gemini response)

**Required fields**:

* `problem` *(string)* ‚Äî 2‚Äì4 sentences; no solution text.  
* `choices` *(array of 4 strings)* ‚Äî plausible, distinct.  
* `answer_index` *(0‚Äì3)* ‚Äî index into `choices`.  
* `solution_html` *(string)* ‚Äî step-by-step HTML ending with `<strong>Answer: ‚Ä¶</strong>`.  

**Example**:

```json
{
  "problem": "A soccer team scored 12 goals in the first 4 games and 8 goals in the next 2. How many total goals did they score?",
  "choices": ["18", "20", "22", "24"],
  "answer_index": 1,
  "solution_html": "First 4 games: 12 goals.<br>Next 2 games: 8 goals.<br>Total = 12 + 8 = 20.<br><strong>Answer: 20</strong>"
}
```

---

## üõü Troubleshooting

* **Empty response** ‚Äî Ensure Worker returns plain text or JSON.  
* **Invalid JSON** ‚Äî Keep prompts strict: ‚ÄúReturn only JSON in this format.‚Äù  
* **CORS issues** ‚Äî Add `Access-Control-Allow-Origin` in Worker.  
* **Rate limits** ‚Äî Show user-friendly fallback like: *‚ÄúWe‚Äôre out of questions right now, try again later.‚Äù*  

---

## üîê Security & privacy

* API keys live only in **Cloudflare Worker env vars** (never in frontend).  
* No personal data stored.  
* Only lightweight history saved in browser via `localStorage`.  

---

## üó∫ Roadmap ideas

* Adaptive difficulty (ELO-style).  
* Timed practice modes.  
* Per-topic mastery tracking.  
* Export attempts as CSV.  
* PWA offline support.  

---

## üìÑ License

MIT (or your preferred license). Include a `LICENSE` file if distributing.  

---

